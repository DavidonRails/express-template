!function e(t,n,s){function i(o,l){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!l&&c)return c(o,!0);if(r)return r(o,!0);throw new Error("Cannot find module '"+o+"'")}var a=n[o]={exports:{}};t[o][0].call(a.exports,function(e){var n=t[o][1][e];return i(n?n:e)},a,a.exports,e,t,n,s)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<s.length;o++)i(s[o]);return i}({1:[function(e,t,n){var s=/<%=([\s\S]+?)%>/g;t.exports=s},{}],2:[function(e,t,n){(function(n){function s(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function i(e,t){for(var n=-1,s=e?e.length:0,i=Array(s);++n<s;)i[n]=t(e[n],n,e);return i}function r(e,t){for(var n=-1,s=Array(e);++n<e;)s[n]=t(n);return s}function o(e,t){return i(t,function(t){return e[t]})}function l(e){return"\\"+Q[e]}function c(e,t){return function(n){return e(t(n))}}function a(e,t){var n=fe(e)||b(e)?r(e.length,String):[],s=n.length,i=!!s;for(var o in e)!t&&!se.call(e,o)||i&&("length"==o||y(o,s))||n.push(o);return n}function u(e,t,n,s){return void 0===e||j(e,ne[n])&&!se.call(s,n)?t:e}function f(e,t,n){var s=e[t];se.call(e,t)&&j(s,n)&&(void 0!==n||t in e)||(e[t]=n)}function p(e){if(!w(e))return le(e);var t=[];for(var n in Object(e))se.call(e,n)&&"constructor"!=n&&t.push(n);return t}function h(e){if(!D(e))return F(e);var t=w(e),n=[];for(var s in e)("constructor"!=s||!t&&se.call(e,s))&&n.push(s);return n}function d(e,t){return t=ce(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,r=ce(n.length-t,0),o=Array(r);++i<r;)o[i]=n[t+i];i=-1;for(var l=Array(t+1);++i<t;)l[i]=n[i];return l[t]=o,s(e,this,l)}}function _(e){if("string"==typeof e)return e;if(T(e))return ue?ue.call(e):"";var t=e+"";return"0"==t&&1/e==-U?"-0":t}function v(e,t,n,s){n||(n={});for(var i=-1,r=t.length;++i<r;){var o=t[i],l=s?s(n[o],e[o],o,n,e):void 0;f(n,o,void 0===l?e[o]:l)}return n}function m(e){return d(function(t,n){var s=-1,i=n.length,r=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(r=e.length>3&&"function"==typeof r?(i--,r):void 0,o&&g(n[0],n[1],o)&&(r=i<3?void 0:r,i=1),t=Object(t);++s<i;){var l=n[s];l&&e(t,l,s,r)}return t})}function y(e,t){return t=null==t?Y:t,!!t&&("number"==typeof e||W.test(e))&&e>-1&&e%1==0&&e<t}function g(e,t,n){if(!D(n))return!1;var s=typeof t;return!!("number"==s?S(n)&&y(t,n.length):"string"==s&&t in n)&&j(n[t],e)}function w(e){var t=e&&e.constructor,n="function"==typeof t&&t.prototype||ne;return e===n}function F(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}function j(e,t){return e===t||e!==e&&t!==t}function b(e){return q(e)&&se.call(e,"callee")&&(!oe.call(e,"callee")||ie.call(e)==L)}function S(e){return null!=e&&E(e.length)&&!x(e)}function q(e){return A(e)&&S(e)}function $(e){return!!A(e)&&(ie.call(e)==M||"string"==typeof e.message&&"string"==typeof e.name)}function x(e){var t=D(e)?ie.call(e):"";return t==N||t==z}function E(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Y}function D(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function A(e){return!!e&&"object"==typeof e}function T(e){return"symbol"==typeof e||A(e)&&ie.call(e)==V}function O(e){return null==e?"":_(e)}function P(e){return S(e)?a(e):p(e)}function I(e){return S(e)?a(e,!0):h(e)}function C(e,t,n){var s=k.imports._.templateSettings||k;n&&g(e,t,n)&&(t=void 0),e=O(e),t=pe({},t,s,u);var i,r,c=pe({},t.imports,s.imports,u),a=P(c),f=o(c,a),p=0,h=t.interpolate||Z,d="__p += '",_=RegExp((t.escape||Z).source+"|"+h.source+"|"+(h===R?J:Z).source+"|"+(t.evaluate||Z).source+"|$","g"),v="sourceURL"in t?"//# sourceURL="+t.sourceURL+"\n":"";e.replace(_,function(t,n,s,o,c,a){return s||(s=o),d+=e.slice(p,a).replace(K,l),n&&(i=!0,d+="' +\n__e("+n+") +\n'"),c&&(r=!0,d+="';\n"+c+";\n__p += '"),s&&(d+="' +\n((__t = ("+s+")) == null ? '' : __t) +\n'"),p=a+t.length,t}),d+="';\n";var m=t.variable;m||(d="with (obj) {\n"+d+"\n}\n"),d=(r?d.replace(B,""):d).replace(G,"$1").replace(H,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(r?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var y=he(function(){return Function(a,v+"return "+d).apply(void 0,f)});if(y.source=d,$(y))throw y;return y}var R=e("lodash._reinterpolate"),k=e("lodash.templatesettings"),U=1/0,Y=9007199254740991,L="[object Arguments]",M="[object Error]",N="[object Function]",z="[object GeneratorFunction]",V="[object Symbol]",B=/\b__p \+= '';/g,G=/\b(__p \+=) '' \+/g,H=/(__e\(.*?\)|\b__t\)) \+\n'';/g,J=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,W=/^(?:0|[1-9]\d*)$/,Z=/($^)/,K=/['\n\r\u2028\u2029\\]/g,Q={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},X="object"==typeof n&&n&&n.Object===Object&&n,ee="object"==typeof self&&self&&self.Object===Object&&self,te=X||ee||Function("return this")(),ne=Object.prototype,se=ne.hasOwnProperty,ie=ne.toString,re=te.Symbol,oe=ne.propertyIsEnumerable,le=c(Object.keys,Object),ce=Math.max,ae=re?re.prototype:void 0,ue=ae?ae.toString:void 0,fe=Array.isArray,pe=m(function(e,t,n,s){v(t,I(t),e,s)}),he=d(function(e,t){try{return s(e,void 0,t)}catch(e){return $(e)?e:new Error(e)}});t.exports=C}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"lodash._reinterpolate":1,"lodash.templatesettings":3}],3:[function(e,t,n){(function(n){function s(e){return function(t){return null==e?void 0:e[t]}}function i(e){if("string"==typeof e)return e;if(o(e))return q?q.call(e):"";var t=e+"";return"0"==t&&1/e==-u?"-0":t}function r(e){return!!e&&"object"==typeof e}function o(e){return"symbol"==typeof e||r(e)&&j.call(e)==f}function l(e){return null==e?"":i(e)}function c(e){return e=l(e),e&&h.test(e)?e.replace(p,w):e}var a=e("lodash._reinterpolate"),u=1/0,f="[object Symbol]",p=/[&<>"'`]/g,h=RegExp(p.source),d=/<%-([\s\S]+?)%>/g,_=/<%([\s\S]+?)%>/g,v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},m="object"==typeof n&&n&&n.Object===Object&&n,y="object"==typeof self&&self&&self.Object===Object&&self,g=m||y||Function("return this")(),w=s(v),F=Object.prototype,j=F.toString,b=g.Symbol,S=b?b.prototype:void 0,q=S?S.toString:void 0,$={escape:d,evaluate:_,interpolate:a,variable:"",imports:{_:{escape:c}}};t.exports=$}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"lodash._reinterpolate":1}],4:[function(e,t,n){"use strict";var s,i,r,o,l={}.hasOwnProperty;i=e("./di/DI"),r=e("./field/Field"),o=e("./utils/merge"),s=function(){function t(t,n,s,c){var a,u,f;this._$el=t(n),this.options=o(this.defaultOptions,s),u=this.options.view;for(a in u)l.call(u,a)&&(f=u[a],void 0!==f.selector&&(this.options.view[a]=t(f.selector).html()));this.options.translate||(this.options.translate={}),this._di=new i,this._di.set("$",t).set("lodash.template",e("lodash.template")).set("models.File",e("./models/File")).set("collections.FilesCollection",e("./collections/FilesCollection")).set("field.Selector",e("./field/Selector")).set("server.Server",e("./server/Server")).set("server.schemes.responses.File",e("./server/schemes/responses/File")).set("server.schemes.responses.Find",e("./server/schemes/responses/Find")).set("server.schemes.responses.List",e("./server/schemes/responses/List")).set("server.schemes.responses.Upload",e("./server/schemes/responses/Upload")).set("server.schemes.requests.Find",e("./server/schemes/requests/Find")).set("server.schemes.requests.List",e("./server/schemes/requests/List")).set("server.schemes.requests.Upload",e("./server/schemes/requests/Upload")).set("server.schemes.requests.Delete",e("./server/schemes/requests/Delete")).set("events.Events",e("./events/Events")).set("utils.DataMap",e("./utils/DataMap")).set("utils.Translate",e("./utils/Translate")).set("utils.Template",e("./utils/Template")).set("utils.uniqueID",e("./utils/uniqueID")).setInstance("collections.FilesCollection",[this._di]).setInstance("events.Events",[this._di]).setInstance("server.Server",[this._di,{schemes:this.options.schemes}]).setInstance("utils.Translate",[this.options.translate]).setInstance("utils.Template",[this._di]),this._field=new r(this._di,n,this.options,c),this._bind()}return t.prototype.defaultOptions={dialog:e("./utils/Dialog"),animationSpeed:500,url:{list:null,upload:null,delete:null,find:null},view:{field:e("./views/field/field"),selector:e("./views/field/selector"),selectorFile:e("./views/field/selectorFile")},valueDelimiter:", ",extensions:null,maxSelected:null,maxUploadSize:null,listLimit:25,schemes:{requests:{find:{id:"id",name:"name",extension:"extension"},list:{id:"id",name:"name",extension:"extension",offset:"offset",limit:"limit"},upload:{file:"file"},delete:{id:"id"}},responses:{file:{id:"id",name:"name",extension:"extension",size:"size",url:"url",preview_url:"preview_url",created_at:"created_at",updated_at:"updated_at"},list:{total:"total",files:"files"},upload:{files:"files"},find:{files:"files"}}},translate:null},t.prototype._bind=function(){var e;e=this._di.getInstance("events.Events"),e.on(this._field,"change",function(t){return function(n,s){return e.trigger(t._$el,"change",[t._filesToFields(s)])}}(this))},t.prototype.allReceivedFiles=function(){return this._filesToFields(this._field.allReceivedFiles())},t.prototype.selectedFiles=function(){return this._filesToFields(this._field.getSelectedFiles())},t.prototype.selectFile=function(e){this._field.setSelectedFiles([e],!0)},t.prototype.deSelectFile=function(e){this._field.deSelectFile(e)},t.prototype.getUID=function(){return this._field.getUID()},t.prototype._filesToFields=function(e){var t,n,s,i;for(i=[],t=n=0,s=e.length;0<=s?n<s:n>s;t=0<=s?++n:--n)i.push(e[t].getFields());return i},t}(),t.exports=s},{"./collections/FilesCollection":5,"./di/DI":6,"./events/Events":7,"./field/Field":8,"./field/Selector":9,"./models/File":11,"./server/Server":12,"./server/schemes/requests/Delete":14,"./server/schemes/requests/Find":15,"./server/schemes/requests/List":16,"./server/schemes/requests/Upload":17,"./server/schemes/responses/File":18,"./server/schemes/responses/Find":19,"./server/schemes/responses/List":20,"./server/schemes/responses/Upload":21,"./utils/DataMap":22,"./utils/Dialog":23,"./utils/Template":24,"./utils/Translate":25,"./utils/merge":26,"./utils/uniqueID":27,"./views/field/field":28,"./views/field/selector":29,"./views/field/selectorFile":30,"lodash.template":2}],5:[function(e,t,n){"use strict";var s;s=function(){function e(e){e.resolve(["utils.DataMap","models.File"]),this._di=e,this._map=e.createObject("utils.DataMap")}return e.prototype.addFiles=function(e){var t,n,s;if(e&&e.length)for(n=0,s=e.length;n<s;n++)t=e[n],this.addFile(t)},e.prototype.addFile=function(e){return e instanceof this._di.get("models.File")||(e=this._objectToFile(e)),!!e&&void this._map.add(e.getField("id"),e)},e.prototype.has=function(e){return this._map.has(e)},e.prototype.getFile=function(e){return this._map.get(e)},e.prototype.getFiles=function(){return this._map.toArray()},e.prototype.removeFile=function(e){this._map.remove(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.length=function(){return this._map.length()},e.prototype._objectToFile=function(e){return this._di.createObject("models.File",[e])},e}(),t.exports=s},{}],6:[function(e,t,n){"use strict";var s;s=function(){function e(){this._functions={},this._instancesData={},this._instances={}}return e.prototype.set=function(e,t){return this._functions[e]=t,this.deleteInstance(e),this},e.prototype.get=function(e){if(!this._functions[e])throw new Error("Dependency with key "+e+" is not resolve.");return this._functions[e]},e.prototype.delete=function(e){return this._functions[e]&&delete this._functions[e],this},e.prototype.createObject=function(e,t){var n;return t=t||[],n=this.get(e),function(e,t,n){n.prototype=e.prototype;var s=new n,i=e.apply(s,t);return Object(i)===i?i:s}(n,t,function(){})},e.prototype.setInstance=function(e,t){return this._instancesData[e]=t||null,this},e.prototype.getInstance=function(e){if(this._instances[e])return this._instances[e];if(void 0===this._instancesData[e])throw new Error("Instance data for dependency with key "+e+" is not set.");return this._instances[e]=this.createObject(e,this._instancesData[e]),this._instances[e]},e.prototype.deleteInstance=function(e){return this._instancesData[e]&&delete this._instancesData[e],this._instances[e]&&delete this._instances[e],this},e.prototype.resolve=function(e,t){var n,s,i,r,o,l;for(e instanceof Array||(e=[e]),t||(t=[]),t instanceof Array||(t=[t]),l=!0,n=0,r=e.length;n<r;n++)if(i=e[n],!this._functions[i]){l=!1;break}if(l)for(s=0,o=t.length;s<o;s++)if(i=t[s],void 0===this._instancesData[i]){l=!1;break}if(!l)throw new Error("Unresolved dependencies.");return this},e}(),t.exports=s},{}],7:[function(e,t,n){"use strict";var s;s=function(){function e(e){e.resolve(["$"]),this._$=e.get("$")}return e.namespace="attachments",e.prototype.on=function(e,t,n,s){var i,r;s=s||{},i=e instanceof this._$?e:this._$(e),r=s.selector||null,i.on(t+"."+this.constructor.namespace,r,n)},e.prototype.trigger=function(e,t,n){return this._$(e).trigger(t+"."+this.constructor.namespace,n)},e}(),t.exports=s},{}],8:[function(e,t,n){"use strict";var s,i={}.hasOwnProperty;s=function(){function e(e,t,n,s){e.resolve(["$","collections.FilesCollection","server.Server","utils.Translate","utils.Template","field.Selector","events.Events"],["collections.FilesCollection","server.Server","utils.Translate","utils.Template","events.Events"]),this._uid=e.get("utils.uniqueID")(),this._$=e.get("$"),this._filesCollection=e.getInstance("collections.FilesCollection"),this._server=e.getInstance("server.Server"),this._translate=e.getInstance("utils.Translate"),this._template=e.getInstance("utils.Template"),this._selector=e.createObject("field.Selector",[e,s,n,this._uid]),this._events=e.getInstance("events.Events"),this._options=n,this._$el=this._$(t),this._$rootElement=this._$(s),this._selected={},this._init()}return e.prototype.allReceivedFiles=function(){return this._filesCollection.getFiles()},e.prototype.setSelectedFiles=function(e,t){var n,s,i;for(t||(this._selected={}),e instanceof Array||(e=[e]),n=0,i=e.length;n<i;n++)s=e[n],this._filesCollection.has(s)&&(this._selected[s]=!0);this._render()},e.prototype.getSelectedFiles=function(){var e,t,n,s;s=[],n=this._selected;for(t in n)i.call(n,t)&&(e=this._filesCollection.getFile(t),e&&s.push(e));return s},e.prototype.deSelectFile=function(e){var t;this._selected&&this._selected[e]&&(delete this._selected[e],t=this._$view.find('[jq-attachments-selected-files-file][data-id="'+e+'"]'),t.hide(this._options.animationSpeed,function(e){return function(){return e._getSelectedFilesID().length?(t.remove(),e._setInputVal(e._getSelectedFilesID())):e._render(),e._triggerChange()}}(this)))},e.prototype.getUID=function(){return this._uid},e.prototype._init=function(){var e;this._bindToSelector(),this._$el.hide(),e=this._options.attached||[],e.length&&this._filesCollection.addFiles(e),this._loadSelected()},e.prototype._loadSelected=function(){var e,t;return t=this._$el.val().split(this._options.valueDelimiter).map(function(e){return e.trim()}),t.length?(e=t.filter(function(e){return function(t){return!e._filesCollection.has(t)}}(this)),void this._server.find(this._options.url.find,{id:e},function(e){return function(t){var n,s,i,r;for(e._filesCollection.addFiles(t.files),r=t.files,s=0,i=r.length;s<i;s++)n=r[s],e.setSelectedFiles(n.id,!0);return e._render()}}(this))):void this._render()},e.prototype._getSelectedFilesID=function(){var e,t,n;n=[],t=this._selected;for(e in t)i.call(t,e)&&n.push(e);return n},e.prototype._render=function(){var e;void 0!==this._$view&&this._$view.remove(),e=this._template.render(this._options.view.field,{files:this.getSelectedFiles()}),this._$view=this._$(e),this._setInputVal(this._getSelectedFilesID()),this._$el.after(this._$view),this._bind(this._$view)},e.prototype._bind=function(e){this._events.on(e,"click",function(e){return function(t){return e._selector.open(e._getSelectedFilesID()),t.preventDefault(),!1}}(this),{selector:"[jq-attachments-add]"}),this._events.on(e,"click",function(e){return function(t){var n;return e._options.dialog.confirm(e._translate.t("Are you sure deselect file?"))&&(n=e._$(t.target).closest("[jq-attachments-selected-files-file]"),n.hide(e._options.animationSpeed,function(){return e.deSelectFile(n.attr("data-id"))})),t.preventDefault()}}(this),{selector:"[jq-attachments-selected-files-file-remove]"})},e.prototype._bindToSelector=function(){return this._events.on(this._selector,"change",function(e){return function(t,n){return e.setSelectedFiles(n),e._triggerChange()}}(this)),this._events.on(this._selector,"delete",function(e){return function(t,n){return e.deSelectFile(n)}}(this))},e.prototype._setInputVal=function(e){this._$el.val(e.join(this._options.valueDelimiter))},e.prototype._triggerChange=function(){this._events.trigger(this,"change",[this.getSelectedFiles()])},e}(),t.exports=s},{}],9:[function(e,t,n){"use strict";var s;s=function(){function e(e,t,n,s){e.resolve(["$","collections.FilesCollection","server.Server","utils.Template","utils.Translate","events.Events"],["collections.FilesCollection","server.Server","utils.Template","utils.Translate","events.Events"]),this._$=e.get("$"),this._filesCollection=e.getInstance("collections.FilesCollection"),this._server=e.getInstance("server.Server"),this._template=e.getInstance("utils.Template"),this._translate=e.getInstance("utils.Translate"),this._events=e.getInstance("events.Events"),this._$rootElement=this._$(t),this._options=n,this._uid=s,this._total=0,this._offset=0,this._selected=[],this._reverted=[]}return e.prototype.open=function(e){var t;this._$view||this._render(),t=e.concat(this._selected),this._selected=e,this._total>0?(this._renderFiles(0,null,null,t),this._show()):(this._show(),this._loadFiles())},e.prototype._render=function(){var e;void 0===this._$view&&(e=this._template.render(this._options.view.selector,{accept:this._accept(),uid:this._uid}),this._$view=this._$(e),this._$rootElement.append(this._$view),this._bind())},e.prototype._accept=function(){var e,t,n,s,i;if(!this._options.extensions)return"";for(i=null,s=this._options.extensions,t=0,n=s.length;t<n;t++)e=s[t],e=e.toLowerCase(),i?i+=", ."+e:i="."+e;return i},e.prototype._bind=function(){this._events.on(this._$view,"click",function(e){return function(t){return e._cancel(),t.preventDefault()}}(this),{selector:"[jq-attachments-window-close]"}),this._events.on(this._$view,"click",function(e){return function(t){var n,s,i;return n=e._$(t.target).closest("[jq-attachments-file]"),s="true"===n.attr("data-selected"),!s&&(i=e._getCurrentSelected(),e._options.maxSelected&&e._options.maxSelected<=i.length)?(e._options.dialog.alert(e._translate.t("Sorry, you can select not more than {maxSelected} file(s).",{maxSelected:e._options.maxSelected})),t.preventDefault(),!1):(e._reverted.push(n.attr("data-id")),n.attr("data-selected",s?"false":"true"))}}(this),{selector:"[jq-attachments-file-select]"}),this._events.on(this._$view,"click",function(e){return function(t){var n;return n=e._$(t.target).closest("[jq-attachments-file]"),e._deleteFile(n.attr("data-id")),t.preventDefault()}}(this),{selector:"[jq-attachments-file-delete]"}),this._events.on(this._$view,"click",function(e){return function(t){return e._apply(),t.preventDefault()}}(this),{selector:"[jq-attachments-apply]"}),this._events.on(this._$view,"click",function(e){return function(t){return e._loadFiles(),t.preventDefault()}}(this),{selector:"[jq-attachments-files-more]"}),this._events.on(this._$view,"click",function(e){return function(t){return e._uploadFile(),t.preventDefault()}}(this),{selector:"[jq-attachments-upload-send]"})},e.prototype._isFileSelected=function(e){return this._$.inArray(e,this._selected)!==-1},e.prototype._renderFiles=function(e,t,n,s){var i,r,o,l,c,a,u,f,p;for(s=s||[],l=this._filesCollection.getFiles(),i=this._$view.find("[jq-attachments-files]"),t&&i.find("[jq-attachments-file]".remove()),c=u=f=e,p=l.length;f<=p?u<p:u>p;c=f<=p?++u:--u)if(o=l[c])if(a=o.getField("id"),r=i.find('[jq-attachments-file][data-id="'+a+'"]'),r.length>0){if(this._$.inArray(a,s)===-1&&this._$.inArray(a,this._reverted)===-1)continue;r.replaceWith(this._getRenderedFile(o))}else n?i.prepend(this._getRenderedFile(o)):i.append(this._getRenderedFile(o))},e.prototype._getRenderedFile=function(e){var t;return t=this._template.render(this._options.view.selectorFile,{file:e,selected:this._isFileSelected(e.getField("id"))}),this._$(t)},e.prototype._apply=function(){var e,t,n,s,i;if(this._reverted=[],i=this._getCurrentSelected(),i.length!==this._selected.length)e=!0;else for(e=!1,n=0,s=i.length;n<s;n++)if(t=i[n],!this._$.inArray(t,this._selected)){e=!0;break}this._selected=i,e&&this._events.trigger(this,"change",[i]),this._hide()},e.prototype._cancel=function(){this._hide()},e.prototype._show=function(){this._$view.show(this._options.animationSpeed)},e.prototype._hide=function(){this._$view.hide(this._options.animationSpeed)},e.prototype._getCurrentSelected=function(){var e,t,n;return e=this._$view.find('[jq-attachments-file][data-selected="true"]'),n=function(){var n,s,i;for(i=[],t=n=0,s=e.length;0<=s?n<s:n>s;t=0<=s?++n:--n)i.push(this._$(e[t]).attr("data-id"));return i}.call(this)},e.prototype._loadFiles=function(e){if(!this._options.url.list)throw new Error("Url for list files is not set.");return this._startProgress(),this._server.list(this._options.url.list,{offset:this._offset,limit:this._options.listLimit,extension:this._options.extensions},function(t){return function(n){return t._filesCollection.addFiles(n.files),t._renderFiles(t._offset),t._offset+=t._options.listLimit,t._total=n.total,t._offset>=t._total?t._$view.find("[jq-attachments-files-more]").hide():t._$view.find("[jq-attachments-files-more]").show(),e&&e(n),t._stopProgress()}}(this),function(e){return function(t,n){throw e._stopProgress(),new Error("Can not load files. Error code "+n+".")}}(this))},e.prototype._deleteFile=function(e){if(this._options.dialog.confirm(this._translate.t("Are you sure want to delete the file?")))return this._startProgress(),this._server.delete(this._options.url.delete,e,function(t){return function(){var n;return t._filesCollection.removeFile(e),t._offset&&t._offset--,n=t._$view.find('[jq-attachments-file][data-id="'+e+'"]'),t._events.trigger(t,"delete",[e]),n.hide(t._options.animationSpeed,function(){return n.remove(),t._stopProgress()})}}(this),function(e){return function(t,n){throw e._stopProgress(),new Error("Can not delete file. Error code "+n+".")}}(this))},e.prototype._uploadFile=function(){var e,t,n,s,i,r,o,l;if(e=this._$view.find("[jq-attachments-upload]"),e.get(0).files.length){for(i=new FormData(e.closest("form").get(0)),s=i.getAll("file[]"),t=[],r=0,o=s.length;r<o;r++)n=s[r],l=this._validateFile(n),l!==!0&&t.push(this._translate.t('File "{name}" is not valid. Error: "{error}"',{name:n.name,error:l}));return t.length>0?void this._options.dialog.alert(t.join("\n")):(this._startProgress(),this._server.upload(this._options.url.upload,i,function(t){return function(n){var s;return e.val("").trigger("change"),s=t._filesCollection.length(),t._filesCollection.addFiles(n.files),t._renderFiles(s,!1,!0),t._stopProgress()}}(this),function(e){return function(t,n){throw e._stopProgress(),new Error("Can not upload files. Error code "+n+".")}}(this)))}},e.prototype._validateFile=function(e){var t;return this._options.maxUploadSize&&this._options.maxUploadSize<e.size?this._translate.t("File size should be <= {size} kb.",{size:Math.round(this._options.maxUploadSize/1024,2)}):!this._options.extensions||(t=e.name.replace(/^.+\.([a-z0-9]+)$/,"$1"),this._$.inArray(t,this._options.extensions)!==-1)||this._translate.t("Invalid file extension. Allowed the following extensions: {extensions}.",{extensions:this._options.extensions.join(", ")})},e.prototype._startProgress=function(){if(this._$view)return this._$view.find("[jq-attachments-progress]").show()},e.prototype._stopProgress=function(){if(this._$view)return this._$view.find("[jq-attachments-progress]").hide()},e}(),t.exports=s},{}],10:[function(e,t,n){(function(t){"use strict";var n,s,i=[].slice;s=e("./Attachments"),n="undefined"!=typeof window?window.$:"undefined"!=typeof t?t.$:null,n.fn.extend({attachments:function(){var e,t,r;return r=arguments[0],e=2<=arguments.length?i.call(arguments,1):[],t=function(t){return function(i){var o;return o=i.data("attachments"),o||i.data("attachments",o=new s(n,t,r,document.body)),"string"==typeof r&&/^[a-zA-Z]+$/.test(r)?o[r].apply(o,e):t}}(this),this.length>1?this.each(function(){return t(n(this))}):t(this)}})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Attachments":4}],11:[function(e,t,n){"use strict";var s,i={}.hasOwnProperty;s=function(){function e(e){this._fields={id:null,name:null,extension:null,size:null,url:null,preview_url:null,created_at:null,updated_at:null},e&&this.setFields(e)}return e.prototype.setFields=function(e){var t,n;for(t in e)i.call(e,t)&&(n=e[t],this.setField(t,n))},e.prototype.setField=function(e,t){void 0!==this._fields[e]&&(this._fields[e]=String(t))},e.prototype.getFields=function(){var e,t,n,s;if(Object.assign)return Object.assign({},this._fields);e={},n=this._fields;for(t in n)i.call(n,t)&&(s=n[t],e[t]=s);return e},e.prototype.getField=function(e){return null!==this._fields[e]?this._fields[e]:null},e}(),t.exports=s},{}],12:[function(e,t,n){"use strict";var s;s=function(){function e(e,t){var n;e.resolve(["$","server.schemes.requests.Find","server.schemes.requests.List","server.schemes.requests.Upload","server.schemes.requests.Delete","server.schemes.responses.File","server.schemes.responses.Find","server.schemes.responses.List","server.schemes.responses.Upload"]),this._$=e.get("$"),n=e.createObject("server.schemes.responses.File",[t.schemes.responses.file]),this._schemes={requests:{find:e.createObject("server.schemes.requests.Find",[t.schemes.requests.find]),list:e.createObject("server.schemes.requests.List",[t.schemes.requests.list]),upload:e.createObject("server.schemes.requests.Upload",[t.schemes.requests.upload]),delete:e.createObject("server.schemes.requests.Delete",[t.schemes.requests.delete])},responses:{file:n,find:e.createObject("server.schemes.responses.Find",[t.schemes.responses.find,{files:n}]),list:e.createObject("server.schemes.responses.List",[t.schemes.responses.list,{files:n}]),upload:e.createObject("server.schemes.responses.Upload",[t.schemes.responses.upload,{files:n}])}}}return e.prototype.find=function(e,t,n,s){return this._$.ajax({url:e,type:"GET",dataType:"json",data:this._schemes.requests.find.toScheme(t)}).done(function(e){return function(s){if(t=e._schemes.responses.find.toData(s),n)return n(t)}}(this)).fail(function(e){return function(e,t){if(s)return s(e,t)}}(this))},e.prototype.list=function(e,t,n,s){return this._$.ajax({url:e,type:"GET",dataType:"json",data:this._schemes.requests.list.toScheme(t)}).done(function(e){return function(t){if(t=e._schemes.responses.list.toData(t),n)return n(t)}}(this)).fail(function(e){return function(e,t){if(s)return s(e,t)}}(this))},e.prototype.upload=function(e,t,n,s){var i,r,o,l,c,a;for(i=new FormData,a=this._schemes.requests.upload.getSchemeFieldName("file"),o=t.getAll("file[]"),l=0,c=o.length;l<c;l++)r=o[l],i.append(a+"[]",r);return this._$.ajax({url:e,type:"POST",contentType:!1,processData:!1,dataType:"json",data:i}).done(function(e){return function(t){if(t=e._schemes.responses.upload.toData(t),n)return n(t)}}(this)).fail(function(e){return function(e,t){if(s)return s(e,t)}}(this))},e.prototype.delete=function(e,t,n,s){return this._$.ajax({url:e,type:"GET",dataType:"json",data:this._schemes.requests.delete.toScheme({id:t})}).done(function(e){return function(){if(n)return n()}}(this)).fail(function(e){return function(e,t){if(s)return s(e,t)}}(this))},e}(),t.exports=s},{}],13:[function(e,t,n){"use strict";var s,i={}.hasOwnProperty;s=function(){function e(e,t){if(this._fields=e,this._dependencies=t?t:{},!this._checkFields())throw new Error("Incorrect fields.");if(!this._checkDependencies())throw new Error("Incorrect dependencies.")}return e.FORMAT_TYPE_DATA="data",e.FORMAT_TYPE_SCHEME="scheme",e.DEPENDENCY_TYPE_ARRAY="array",e.DEPENDENCY_TYPE_OBJECT="object",e.prototype.fields=function(){return[]},e.prototype.dependencies=function(){return{}},e.prototype.toData=function(e){var t,n,s,r,o;s={},n=this._fields;for(t in n)i.call(n,t)&&(r=n[t],o=e[r],void 0!==o&&(s[t]=this._formatValue(this.constructor.FORMAT_TYPE_DATA,t,o)));return s},e.prototype.toScheme=function(e){var t,n,s,r,o;s={},n=this._fields;for(t in n)i.call(n,t)&&(r=n[t],o=e[t],void 0!==o&&(s[r]=this._formatValue(this.constructor.FORMAT_TYPE_SCHEME,t,o)));return s},e.prototype.getSchemeFieldName=function(e){if(void 0!==this._fields[e])return this._fields[e]},e.prototype._checkFields=function(){var e,t,n,s,i;for(i=!0,t=this.fields(),n=0,s=t.length;n<s;n++)if(e=t[n],void 0===this._fields[e]){i=!1;break}return i},e.prototype._checkDependencies=function(){var e,t,n,s;e=this.dependencies();for(n in e)if(i.call(e,n))if(t=e[n],s=this._dependencies[n],t instanceof Array){if(t=t[1],!(s instanceof t))return!1}else if(!(s instanceof t))return!1;return!0},e.prototype._formatValue=function(e,t,n){var s,r,o,l,c,a,u,f;if(s=this._dependencies[t],!s)return n;if(r=this.dependencies()[t],!(r instanceof Array))return this._dependencyValue(e,n,s);if(o=r[0],o===this.constructor.DEPENDENCY_TYPE_ARRAY){if(!(n instanceof Array))return;for(a=[],l=0,c=n.length;l<c;l++)u=n[l],a.push(this._dependencyValue(e,u,s));return a}if(o===this.constructor.DEPENDENCY_TYPE_OBJECT){a={};for(f in n)i.call(n,f)&&(a[f]=this._dependencyValue(e,n[f],s));return a}return null},e.prototype._dependencyValue=function(e,t,n){return e===this.constructor.FORMAT_TYPE_DATA?n.toData(t):e===this.constructor.FORMAT_TYPE_SCHEME?n.toScheme(t):void 0},e}(),t.exports=s},{}],14:[function(e,t,n){"use strict";var s,i,r=function(e,t){function n(){this.constructor=e}for(var s in t)o.call(t,s)&&(e[s]=t[s]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},o={}.hasOwnProperty;s=e("../AbstractScheme"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return r(t,e),t.prototype.fields=function(){return["id"]},t}(s),t.exports=i},{"../AbstractScheme":13}],15:[function(e,t,n){"use strict";var s,i,r=function(e,t){function n(){this.constructor=e}for(var s in t)o.call(t,s)&&(e[s]=t[s]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},o={}.hasOwnProperty;s=e("../AbstractScheme"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return r(t,e),t.prototype.fields=function(){return["id","name","extension"]},t}(s),t.exports=i},{"../AbstractScheme":13}],16:[function(e,t,n){"use strict";var s,i,r=function(e,t){function n(){this.constructor=e}for(var s in t)o.call(t,s)&&(e[s]=t[s]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},o={}.hasOwnProperty;s=e("../AbstractScheme"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return r(t,e),t.prototype.fields=function(){return["id","name","extension","offset","limit"]},t}(s),t.exports=i},{"../AbstractScheme":13}],17:[function(e,t,n){"use strict";var s,i,r=function(e,t){function n(){this.constructor=e}for(var s in t)o.call(t,s)&&(e[s]=t[s]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},o={}.hasOwnProperty;s=e("../AbstractScheme"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return r(t,e),t.prototype.fields=function(){return["file"]},t}(s),t.exports=i},{"../AbstractScheme":13}],18:[function(e,t,n){"use strict";var s,i,r=function(e,t){function n(){this.constructor=e}for(var s in t)o.call(t,s)&&(e[s]=t[s]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,
e},o={}.hasOwnProperty;s=e("../AbstractScheme"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return r(t,e),t.prototype.fields=function(){return["id","name","extension","size","url","preview_url","created_at","updated_at"]},t}(s),t.exports=i},{"../AbstractScheme":13}],19:[function(e,t,n){"use strict";var s,i,r,o=function(e,t){function n(){this.constructor=e}for(var s in t)l.call(t,s)&&(e[s]=t[s]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},l={}.hasOwnProperty;s=e("../AbstractScheme"),i=e("./File"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.fields=function(){return["files"]},t.prototype.dependencies=function(){return{files:[s.DEPENDENCY_TYPE_ARRAY,i]}},t}(s),t.exports=r},{"../AbstractScheme":13,"./File":18}],20:[function(e,t,n){"use strict";var s,i,r,o=function(e,t){function n(){this.constructor=e}for(var s in t)l.call(t,s)&&(e[s]=t[s]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},l={}.hasOwnProperty;s=e("../AbstractScheme"),i=e("./File"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.fields=function(){return["total","files"]},t.prototype.dependencies=function(){return{files:[s.DEPENDENCY_TYPE_ARRAY,i]}},t}(s),t.exports=r},{"../AbstractScheme":13,"./File":18}],21:[function(e,t,n){"use strict";var s,i,r,o=function(e,t){function n(){this.constructor=e}for(var s in t)l.call(t,s)&&(e[s]=t[s]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},l={}.hasOwnProperty;s=e("../AbstractScheme"),i=e("./File"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.fields=function(){return["files"]},t.prototype.dependencies=function(){return{files:[s.DEPENDENCY_TYPE_ARRAY,i]}},t}(s),t.exports=r},{"../AbstractScheme":13,"./File":18}],22:[function(e,t,n){"use strict";var s,i={}.hasOwnProperty;s=function(){function e(e){this._items={},this._order=[],e&&this.addItems(e)}return e.prototype.has=function(e){return void 0!==this._items[e]},e.prototype.addItems=function(e){var t;for(t in e)i.call(e,t)&&this.add(t,e[t])},e.prototype.add=function(e,t){this.has(e)?this._items[e]=t:(this._items[e]=t,this._order.push(e.toString()))},e.prototype.get=function(e){return this.has(e)?this._items[e]:null},e.prototype.remove=function(e){var t;delete this._items[e],t=this._order.indexOf(e.toString()),t!==-1&&this._order.splice(t,1)},e.prototype.each=function(e){var t,n,s,i;for(i=this._order,t=0,s=i.length;t<s;t++)n=i[t],e(n,this.get(n))},e.prototype.all=function(){var e,t,n,s,i;for(i=[],s=this._order,e=0,n=s.length;e<n;e++)t=s[e],i.push({key:t,value:this.get(t)});return i},e.prototype.toArray=function(){var e,t,n,s,i;for(i=[],s=this._order,e=0,n=s.length;e<n;e++)t=s[e],i.push(this.get(t));return i},e.prototype.clear=function(){this._items={},this._order=[]},e.prototype.length=function(){return this._order.length},e}(),t.exports=s},{}],23:[function(e,t,n){"use strict";var s;s=function(){function e(){}return e.alert=function(e){alert(e)},e.confirm=function(e){return confirm(e)},e}(),t.exports=s},{}],24:[function(e,t,n){"use strict";var s;s=function(){function e(e){e.resolve(["lodash.template","utils.Translate"],["utils.Translate"]),this._template=e.get("lodash.template"),this._translate=e.getInstance("utils.Translate")}return e.prototype.render=function(e,t){var n;return t||(t={}),t.translate=this._translate,(n=this._template(e))(t)},e}(),t.exports=s},{}],25:[function(e,t,n){"use strict";var s,i,r={}.hasOwnProperty;i=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},s=function(){function e(e){this._phrases=e}return e.prototype.t=function(e,t){var n;return n=this._phrases[e]?this._phrases[e]:e,t&&(n=this._replaceParams(n,t)),n},e.prototype._replaceParams=function(e,t){var n,s,o;for(s in t)r.call(t,s)&&(o=t[s],n=new RegExp(i("{"+s+"}"),"g"),e=e.replace(n,o));return e},e}(),t.exports=s},{}],26:[function(e,t,n){"use strict";var s,i={}.hasOwnProperty;s=function(e,t){var n,r,o;r={};for(n in e)i.call(e,n)&&(o=e[n],"object"==typeof o&&void 0!==t[n]?null!==o?r[n]=s(o,t[n]):r[n]=t[n]:void 0!==t[n]?r[n]=t[n]:r[n]=o);return r},t.exports=s},{}],27:[function(e,t,n){"use strict";var s,i;s={},i=function(){var e;return e="uid"+Math.random().toString().replace("0.",""),s[e]?e=i():s[e]=!0,e},t.exports=i},{}],28:[function(e,t,n){"use strict";var s;s=' <div class="jq-attachments-selected <%= (files.length == 0) ? \'empty\' : \'\' %>">\n   <div class="jq-attachments-selected-empty"><%= translate.t(\'No attached files.\')%></div>\n   <ul class="jq-attachments-selected-files" jq-attachments-selected-files>\n   <% for (var i = 0, l = files.length; i<l; i++) {%>\n       <% file = files[i]%>\n       <li class="jq-attachments-selected-file" data-id="<%= file.getField(\'id\')%>" jq-attachments-selected-files-file>\n           <a class="jq-attachments-selected-file-load" href="<%= file.getField(\'url\')%>" target="_blank"><%= file.getField(\'name\')%></a>\n           <span class="jq-attachments-selected-file-remove" jq-attachments-selected-files-file-remove>+</span>\n       </li>\n   <%}%>\n   </ul>\n   <button class="jq-attachments-add" jq-attachments-add><%= translate.t(\'Add files\')%></button>\n</div>',t.exports=s},{}],29:[function(e,t,n){"use strict";var s;s='<section uid="<%= uid%>" class="jq-attachments-window" jq-attachments-window>\n    <div class="jq-attachments-window-content">\n        <header class="jq-attachments-window-content-header">\n            <form enctype="multipart/form-data">\n                <div class="jq-attachments-upload">\n                  <label>\n                    <input type="file" name="file[]" jq-attachments-upload multiple accept="<%= accept%>"/>\n                    <span data-role="upload-text"><%= translate.t(\'Select files\')%></span>\n                  </label>\n                </div>\n                <input type="submit" class="jq-attachments-upload-send" value="upload" jq-attachments-upload-send disabled/>\n            </form>\n            <div class="jq-attachments-progress" title="<%= translate.t(\'Wait...\')%>" jq-attachments-progress>\n                <div></div>\n            </div>\n            <span class="jq-attachments-window-close" jq-attachments-window-close>+</span>\n        </header>\n        <main class="jq-attachments-window-content-main">\n            <div class="jq-attachments-files">\n              <div jq-attachments-files>\n              </div>\n              <input type="submit" value="<%= translate.t(\'Load more files\')%>" class="jq-attachments-files-more" jq-attachments-files-more/>\n            </div>\n        </main>\n        <footer class="jq-attachments-window-content-footer">\n            <input type="submit" value="<%= translate.t(\'Save\')%>" class="jq-attachments-apply" jq-attachments-apply/>\n            <input type="submit" value="<%= translate.t(\'Cancel\')%>" class="jq-attachments-cancel" jq-attachments-window-close/>\n        </footer>\n    </div>\n    <div class="jq-attachments-window-bg" jq-attachments-window-close></div>\n</section>\n\n<%\n//script for  UI logic (custom upload form)\nvar interval = null;\nvar renderUpload = function ()\n {\n   var fieldFile = document.querySelector(\'[uid="\' + uid + \'"] [jq-attachments-upload]\');\n   if (fieldFile) {\n     clearInterval(interval);\n     var uploadSendButton = document.querySelector(\'[uid="\' + uid + \'"] [jq-attachments-upload-send]\');\n     var uploadText = document.querySelector(\'[uid="\' + uid + \'"] [data-role="upload-text"]\');\n     fieldFile.onchange = function () {\n        var countFiles = this.files.length;\n        var message;\n        if (countFiles) {\n          message = translate.t(\'Selected {countFiles} files\', {countFiles: countFiles});\n        } else {\n          message = translate.t(\'Select files\');\n        }\n        uploadText.innerHTML = message;\n        uploadSendButton.disabled = !countFiles;\n     };\n   }\n};\n\ninterval = setInterval(renderUpload, 100);\n%>',t.exports=s},{}],30:[function(e,t,n){"use strict";var s;s='<div class="jq-attachments-file" data-id="<%= file.getField(\'id\')%>" data-selected="<%= (selected ? \'true\' : \'false\')%>" jq-attachments-file>\n    <input type="checkbox" jq-attachments-file-select<%= (selected ? \' checked\' : \'\')%>/>\n    <span class="jq-attachments-file-delete" jq-attachments-file-delete></span>\n    <img src="<%= file.getField(\'preview_url\')%>" alt="<%= file.getField(\'name\')%>"/>\n    <a href="<%= file.getField(\'url\')%>" target="_blank" title="<%= file.getField(\'name\')%>" class="jq-attachments-file-link"><%= file.getField(\'name\')%></a>\n</div>',t.exports=s},{}]},{},[10]);